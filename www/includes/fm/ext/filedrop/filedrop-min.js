window.fd=window.fd||{logging:true,onObjCall:null,isIE6:false,isChrome:(navigator.vendor||"").indexOf("Google")!=-1,isFirebug:!!(window.console&&window.console.dir)};fd.RandomID=function(){return"fd_"+(Math.random()*1e4).toFixed()};fd.ByID=function(a){return fd.IsTag(a)?a:document.getElementById(a)};fd.IsTag=function(a,b){return typeof a=="object"&&a&&a.nodeType==1&&(!b||a.tagName.toUpperCase()==b.toUpperCase())};fd.NewXHR=function(){try{return new XMLHttpRequest}catch(a){var b=new Array("MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.5.0","MSXML2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP");for(var c=0;c<b.length&&!request;c++){try{return new ActiveXObject(b[c])}catch(a){}}}};fd.InstanceOf=function(a,b){a=a.toLowerCase();var c=b&&b.constructor?b.constructor:"";return c.name?c.name.toLowerCase()==a:c.toString().toLowerCase().indexOf(a)!=-1};fd.IsArray=function(a){return typeof a=="object"&&fd.InstanceOf("Array",a)};fd.AddEvent=function(a,b,c){if(a.attachEvent){a["e"+b+c]=c;a[b+c]=function(){a["e"+b+c](window.event)};a.attachEvent("on"+b,a[b+c])}else{a.addEventListener(b,c,false)}};fd.StopEvent=function(a){a.cancelBubble=true;a.returnValue=false;if(a.stopPropagation){a.stopPropagation()}if(a.preventDefault){a.preventDefault()}};fd.SetClass=function(a,b,c){a=fd.ByID(a);if(fd.IsTag(a)){if(typeof c=="undefined"||c){if(!fd.HasClass(a,b)){a.className+=" "+b}}else{a.className=a.className.replace(fd.ClassRegExp(b)," ")}}};fd.HasClass=function(a,b){return fd.ClassRegExp(b).test((fd.ByID(a)||{}).className)};fd.ClassRegExp=function(a){return new RegExp("(^|\\s)"+a+"(\\s|$)","gi")};fd.Extend=function(a,b,c){for(var d in b){if(c||typeof a[d]=="undefined"){a[d]=b[d]}}};fd.CallAll=function(a,b,c){b=fd.IsArray(b)?b:[b];var d;if(fd.IsArray(a)){for(var e=0;e<a.length;e++){if(typeof a[e]=="function"){d=a[e].apply(c||this,b);if(d!=null){break}}}}else if(typeof a!="undefined"&&a!=null&&fd.isFirebug){console.error("FileDrop event list must be either an Array or undefined/null,"+" "+typeof a+" was given.")}return d};fd.CallOf=function(a,b,c){if(fd.logging&&fd.isFirebug){var d=a.on[b]?a.on[b].length:0;console.info("FileDrop "+b+" event ("+d+"); args:");console.dir([c])}if(typeof fd.onObjCall=="function"){var e=fd.onObjCall.call(a,b,c);if(e!=null){return e}}return fd.CallAll(a.on[b],c,a)};fd.DropHandle=function(a,b){var c=this;c.zone=a=fd.ByID(a);c.opt={zoneClass:"fd-zone",inputClass:"fd-file",iframe:{url:""},input:null,fullDocDragDetect:false};fd.Extend(c.opt,b,true);if(fd.isChrome){c.opt.fullDocDragDetect=true}c.on={dragEnter:[],dragLeave:[],dragOver:[],dragEnd:[],dragExit:[],upload:[],inputSetup:[],iframeSetup:[],iframeDone:[]};c.Hook=function(a){if(c.opt.input!=false){c.opt.input=c.opt.input||c.PrepareInput(a);if(c.opt.input){fd.CallOf(c,"inputSetup",c.opt.input)}}c.HookDragOn(a);c.HookDropOn(a)};c.HookDragOn=function(a){function b(b,d){fd.AddEvent(d?document.body:a,b.toLowerCase(),function(a){fd.StopEvent(a);fd.CallOf(c,b,a)})}if(c.opt.fullDocDragDetect){b("dragEnter",true);fd.AddEvent(document,"dragleave",function(a){if(a.clientX==0&&a.clientY==0||fd.IsTag(a.relatedTarget,"html")){fd.StopEvent(a);fd.CallOf(c,"dragLeave",a)}})}else{b("dragEnter");b("dragLeave")}if(!fd.isChrome){b("dragOver")}b("dragEnd");b("dragExit")};c.HookDropOn=function(a){function b(a){fd.StopEvent(a);fd.CallOf(c,"upload",a)}if(!fd.isIE6){fd.AddEvent(a,"drop",b)}fd.AddEvent(c.opt.input.file,"change",b)};c.PrepareInput=function(a){var b={file:c.FindInputRec(a)||c.CreateInputAt(a)};if(b.file){var d=b.file.parentNode;while(d&&!fd.IsTag(d,"form")){d=b.form.parentNode}var e=d?d.getAttribute("target"):"";if(e&&fd.IsTag(fd.ByID(e),"iframe")){b.form=d}}return b};c.FindInputRec=function(a){var b;for(var d=0;!b&&d<a.childNodes.length;d++){var e=a.childNodes[d];if(fd.IsTag(e,"input")&&e.getAttribute("type")=="file"&&fd.HasClass(e,c.opt.inputClass)){b=e}else if(e.childNodes.length>0){b=c.FindInputRec(e)}}return b};c.CreateInputAt=function(a){do{var b=fd.RandomID()}while(fd.ByID(b));var c=document.createElement("div");c.innerHTML='<iframe src="javascript:false;" name="'+b+'"></iframe>'+'<form method="post" enctype="multipart/form-data">'+'<input type="hidden" name="fd-callback" />'+'<input type="file" name="fd-file" />'+"</form>";c.firstChild.setAttribute("id",b);c.firstChild.style.display="none";c.lastChild.setAttribute("target",b);var d=a.firstChild;while(d&&(!fd.IsTag(d)||fd.IsTag(d,"legend"))){d=d.nextSibling}if(d){a.insertBefore(c,d)}else{a.appendChild(c)}return c.lastChild.lastChild};c.AbortIFrame=function(){if(c.opt.input.form){var a=fd.ByID(c.opt.input.form.getAttribute("target"));if(a){a.setAttribute("src","javascript:false;")}}};c.SendViaIFrame=function(a){a=a||c.opt.iframe.url;var b=(c.opt.input||{}).form;if(a&&b){do{var d=fd.RandomID()}while(window[d]);window[d]=function(b){var d=typeof b=="object"?b:{response:b,responseText:b,readyState:4,status:200};fd.Extend(d,{iframe:true,url:a});fd.CallOf(c,"iframeDone",d)};var e=b.firstChild;while(e&&(!fd.IsTag(e,"input")||e.name!="fd-callback")){e=e.nextSibling}if(e){e.value=d}else{a=a.replace(/[?&]$/,"")+(a.indexOf("?")==-1?"?":"&")+"fd-callback="+d}b.setAttribute("action",a);fd.CallOf(c,"iframeSetup",b);b.submit()}};c.Multiple=function(a){if(!c.opt.input){throw"FileDrop.Multiple(): no self.opt.input assigned."}if(typeof a!="undefined"){a?c.opt.input.file.setAttribute("multiple","multiple"):c.opt.input.file.removeAttribute("multiple")}return!!c.opt.input.file.getAttribute("multiple")};c.SetupInput=function(b){b.file.className=c.opt.inputClass;var d=b.file.parentNode;if(d&&d.style.display.match(/^(static)?$/)){d.style.position="relative"}if(fd.IsTag(a,"fieldset")){var e=document.createElement("div");e.style.position="relative";e.style.overflow="hidden";a.parentNode.insertBefore(e,a);e.appendChild(a)}};c.on.inputSetup.push(c.SetupInput);fd.SetClass(a,c.opt.zoneClass);c.Hook(a)};fd.FileDrop=function(a,b){var c=this;a=fd.ByID(a);c.handle=new fd.DropHandle(a,b);c.opt=c.handle.opt;fd.Extend(c.opt,{dragOverClass:"over"});fd.Extend(c.opt.iframe,{force:false});fd.Extend(c.opt,b,true);c.on=c.handle.on;fd.Extend(c.on,{send:[],fileSetup:[]});c.SetClassesTo=function(a,b){fd.SetClass(a,c.opt.dragOverClass,b)};c.OnUpload=function(a){var b=!c.opt.iframe.force&&c.GetFilesFrom(a);if(b==false){c.handle.SendViaIFrame()}else if(b.length>0){fd.CallOf(c,"send",[b])}};c.GetFilesFrom=function(a){var b=a.dataTransfer?a.dataTransfer:a.target?a.target.files:false;if(b==false){return false}if(b.files){b=b.files}var d=[];var e={};for(var f=0;f<b.length;f++){var g=new fd.File(b[f]);if(e[g.name]){continue}e[g.name]=true;fd.CallOf(c,"fileSetup",g);if(g.size>0){d.push(g)}}return d};c.on.upload.push(c.OnUpload);c.on.dragEnter.push(function(){c.SetClassesTo(a,true)});c.on.dragLeave.push(function(){c.SetClassesTo(a,false)});c.on.upload.unshift(function(){c.SetClassesTo(a,false)});fd.Extend(c,c.handle)};window.FileDrop=fd.FileDrop;fd.File=function(a){var b=this;b.nativeFile=a;b.name=a.fileName||a.name;b.size=a.fileSize||a.size;b.xhr=null;b.opt={extraHeaders:true};b.on={sendXHR:[],progress:[],done:[],error:[]};b.SendTo=function(a){if(window.FileReader){var c=new FileReader;c.onload=function(c){b.DoSendTo(a,c)};c.onerror=function(a){fd.CallOf(b,"error",[a])};c.readAsBinaryString(b.nativeFile)}else{b.DoSendTo(a)}};b.DoSendTo=function(a,c){b.Abort();b.xhr=fd.NewXHR();b.HookXHR(b.xhr);b.xhr.open("POST",a,true);b.xhr.overrideMimeType("application/octet-stream");b.xhr.setRequestHeader("Content-Type","application/octet-stream");if(b.opt.extraHeaders){b.xhr.setRequestHeader("X-File-Name",encodeURIComponent(b.name));b.xhr.setRequestHeader("X-File-Size",b.size);var d=window.FileReader?"FileAPI":"Webkit";b.xhr.setRequestHeader("X-Requested-With","FileDrop-XHR-"+d)}var e=c&&c.target&&c.target.result?c.target.result:b.nativeFile;fd.CallOf(b,"sendXHR",[b.xhr,e])};b.HookXHR=function(a){var c=a.upload||a;a.onreadystatechange=function(c){if(a.readyState==4){try{var d=a.status==200?"done":"error"}catch(c){var d="error"}var e=d=="error"?[c,a]:[a,c];fd.CallOf(b,d,e)}};c.onprogress=function(c){var d=c.lengthComputable?c.loaded:null;fd.CallOf(b,"progress",[d,c.total,a,c,b.name])}};b.Abort=function(){if(b.xhr&&b.xhr.abort){b.xhr.abort()}};b.SendXHR=function(a,b){if(a.sendAsBinary){a.sendAsBinary(b)}else if(typeof b=="string"){try{var c=Array.prototype.map.call(b,function(a){return a.charCodeAt(0)&255});var d=new Uint8Array(c);a.send(d.buffer)}catch(e){a.send(b)}}else{a.send(b)}};b.on.sendXHR.push(b.SendXHR)}